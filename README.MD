# ğŸ¦ API Despesas - Backend

Uma API REST robusta para gerenciamento de despesas recorrentes, desenvolvida com Node.js, Express e MongoDB. Inclui autenticaÃ§Ã£o JWT, testes automatizados e usuÃ¡rio demo para demonstraÃ§Ãµes.

## ğŸš€ Tecnologias Utilizadas

### Core
- **Node.js** - Runtime JavaScript
- **Express.js** - Framework web
- **MongoDB** - Banco de dados NoSQL
- **Mongoose** - ODM para MongoDB

### AutenticaÃ§Ã£o & SeguranÃ§a
- **JWT (jsonwebtoken)** - AutenticaÃ§Ã£o via tokens
- **bcryptjs** - Criptografia de senhas
- **CORS** - Controle de acesso entre origens

### UtilitÃ¡rios
- **dotenv** - Gerenciamento de variÃ¡veis de ambiente
- **cookie-parser** - ManipulaÃ§Ã£o de cookies
- **dayjs** - ManipulaÃ§Ã£o de datas

### Testes
- **Jest** - Framework de testes
- **Supertest** - Testes de API
- **MongoDB Memory Server** - MongoDB em memÃ³ria para testes

## ğŸ“‹ PrÃ©-requisitos

- Node.js 18+
- npm ou yarn
- MongoDB (local ou remoto)

## âš™ï¸ ConfiguraÃ§Ã£o

### 1. Clone e instale dependÃªncias

```bash
# Clone o projeto
git clone <url-do-repositorio>
cd despesas-recorrentes/api-despesas

# Instale as dependÃªncias
npm install
```

### 2. Configure as variÃ¡veis de ambiente

Crie um arquivo `.env` na raiz do projeto:

```env
# Servidor
PORT=8000
NODE_ENV=development

# Frontend
FRONTEND_URL=http://localhost:3000

# Banco de dados
MONGODB_URI=mongodb://localhost:27017/despesas_recorrentes

# AutenticaÃ§Ã£o
JWT_SECRET=sua_chave_secreta_super_forte_aqui

# Registro
REGISTER_PASSWORD=admin123

# UsuÃ¡rio Demo
DEMO_USER_EMAIL=demo@exemplo.com
DEMO_USER_PASSWORD=visitante@2025
```

### 3. Execute o projeto

```bash
# Desenvolvimento
npm run dev

# Testes
npm test
npm run test:watch
npm run test:coverage
```

A API estarÃ¡ disponÃ­vel em [http://localhost:8000](http://localhost:8000)

## ğŸ—ï¸ Estrutura do Projeto

```
api-despesas/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/           # ConfiguraÃ§Ãµes (banco, etc)
â”‚   â”œâ”€â”€ controllers/      # Controladores das rotas
â”‚   â”œâ”€â”€ middlewares/      # Middlewares customizados
â”‚   â”œâ”€â”€ models/          # Modelos do MongoDB
â”‚   â”œâ”€â”€ routes/          # DefiniÃ§Ã£o das rotas
â”‚   â”œâ”€â”€ services/        # LÃ³gica de negÃ³cio
â”‚   â”œâ”€â”€ tests/           # Testes automatizados
â”‚   â””â”€â”€ utils/           # UtilitÃ¡rios
â”œâ”€â”€ mongo-init.js        # Script de inicializaÃ§Ã£o do MongoDB
â””â”€â”€ server.js           # Ponto de entrada da aplicaÃ§Ã£o
```

## ğŸ” AutenticaÃ§Ã£o

### Registro de UsuÃ¡rio
```http
POST /api/users/register
Content-Type: application/json

{
  "name": "JoÃ£o Silva",
  "email": "joao@exemplo.com",
  "password": "minhasenha123",
  "registerPassword": "admin123"
}
```

### Login
```http
POST /api/users/login
Content-Type: application/json

{
  "email": "joao@exemplo.com",
  "password": "minhasenha123"
}
```

## ğŸ¯ Endpoints Principais

### Despesas
```http
GET    /api/expenses          # Listar despesas
POST   /api/expenses          # Criar despesa
PUT    /api/expenses/:id      # Atualizar despesa
DELETE /api/expenses/:id      # Remover despesa
```

### Despesas Mensais
```http
GET    /api/monthly-expenses  # Listar despesas mensais
POST   /api/monthly-expenses  # Criar despesa mensal
PUT    /api/monthly-expenses/:id  # Atualizar
DELETE /api/monthly-expenses/:id  # Remover
```

### Pagamentos
```http
GET    /api/payments          # Listar pagamentos
POST   /api/payments          # Criar pagamento
PUT    /api/payments/:id      # Atualizar pagamento
DELETE /api/payments/:id      # Remover pagamento
```

### Variantes
```http
GET    /api/variants          # Listar variantes
POST   /api/variants          # Criar variante
PUT    /api/variants/:id      # Atualizar variante
DELETE /api/variants/:id      # Remover variante
```

## ğŸª UsuÃ¡rio Demo

O sistema inclui um usuÃ¡rio de demonstraÃ§Ã£o com dados resetados automaticamente Ã  meia-noite todos os dias.

### Credenciais Demo
```http
GET /api/demo/credentials
```

**Resposta:**
```json
{
  "message": "Credenciais do usuÃ¡rio demo",
  "credentials": {
    "email": "demo@exemplo.com",
    "password": "visitante@2025"
  },
  "note": "Dados resetados diariamente Ã  meia-noite"
}
```

### Reset Manual
```http
POST /api/demo/reset
```

### Inicializar Demo
```http
POST /api/demo/initialize
```

## ğŸ§ª Testes

```bash
# Executar todos os testes
npm test

# Modo watch (desenvolvimento)
npm run test:watch

# Cobertura de cÃ³digo
npm run test:coverage

# Testes verbosos
npm run test:verbose
```

## ğŸ³ Docker

```bash
# Build da imagem
docker build -t api-despesas .

# Executar com Docker Compose
docker-compose up -d
```

## ğŸ” VariÃ¡veis de Ambiente ObrigatÃ³rias

| VariÃ¡vel | DescriÃ§Ã£o | Exemplo |
|----------|-----------|---------|
| `PORT` | Porta do servidor | `8000` |
| `MONGODB_URI` | URI do MongoDB | `mongodb://localhost:27017/despesas` |
| `JWT_SECRET` | Chave secreta JWT | `chave-super-secreta` |
| `FRONTEND_URL` | URL do frontend | `http://localhost:3000` |
| `REGISTER_PASSWORD` | Senha para registro | `admin123` |
| `DEMO_USER_EMAIL` | Email do usuÃ¡rio demo | `demo@exemplo.com` |
| `DEMO_USER_PASSWORD` | Senha do usuÃ¡rio demo | `visitante@2025` |

## ğŸ“Š Scripts DisponÃ­veis

```bash
npm run dev          # Desenvolvimento com nodemon
npm test             # Executar testes
npm run test:watch   # Testes em modo watch
npm run test:coverage # Cobertura de testes
```

## ğŸ¤ Contribuindo

1. FaÃ§a o fork do projeto
2. Crie uma branch para sua feature (`git checkout -b feature/AmazingFeature`)
3. Commit suas mudanÃ§as (`git commit -m 'Add some AmazingFeature'`)
4. Push para a branch (`git push origin feature/AmazingFeature`)
5. Abra um Pull Request

## ğŸ“ LicenÃ§a

Este projeto estÃ¡ sob a licenÃ§a ISC.

## ğŸ‘¨â€ğŸ’» Autor

Paulo Henrique - [@Paulo-Henrique21](https://github.com/Paulo-Henrique21)

---

â­ DÃª uma estrela se este projeto te ajudou!
